/* =========================================
   Controle de Abas da Matriz Curricular
   Acessibilidade (WCAG + ARIA)
   Autor: Luiz Barbosa
   Otimizado com apoio de Inteligência Artificial
   Uso acadêmico, profissional e demonstrativo
   ========================================= */

/* Seleciona abas e conteúdos */
const tabs = document.querySelectorAll(".semester-tab");
const semestres = document.querySelectorAll(".semestre");

/* Função principal: ativa o semestre selecionado */
function ativarSemestre(numero) {
  /* Atualiza conteúdos */
  semestres.forEach(sec => {
    const ativo = sec.getAttribute("data-semestre") === numero;
    sec.classList.toggle("active", ativo);
    sec.setAttribute("aria-hidden", ativo ? "false" : "true");
  });

  /* Atualiza abas */
  tabs.forEach(tab => {
    const ativo = tab.getAttribute("data-semestre") === numero;

    tab.classList.toggle("active", ativo);
    tab.setAttribute("aria-selected", ativo ? "true" : "false");
    tab.setAttribute("tabindex", ativo ? "0" : "-1");

    if (ativo) tab.focus(); // Foca automaticamente na aba ativa
  });

  /* Atualiza último item do breadcrumb */
  const breadcrumbSpan = document.querySelector(".breadcrumb span:last-child");
  if (breadcrumbSpan) {
    breadcrumbSpan.textContent = `${numero}º Semestre`;
  }
}

/* Navegação por teclado (WCAG) */
function configurarNavegacaoTeclado() {
  tabs.forEach((tab, index) => {

    /* Ativação por clique */
    tab.addEventListener("click", () => {
      const numero = tab.getAttribute("data-semestre");
      ativarSemestre(numero);
    });

    /* Ativação e navegação por teclado */
    tab.addEventListener("keydown", (e) => {
      const currentIndex = index;
      let nextIndex;

      switch(e.key) {
        case "Enter":
        case " ":
          e.preventDefault();
          const numero = tab.getAttribute("data-semestre");
          ativarSemestre(numero);
          break;

        case "ArrowRight":
        case "ArrowDown":
          e.preventDefault();
          nextIndex = (currentIndex + 1) % tabs.length;
          tabs[nextIndex].focus();
          break;

        case "ArrowLeft":
        case "ArrowUp":
          e.preventDefault();
          nextIndex = (currentIndex - 1 + tabs.length) % tabs.length;
          tabs[nextIndex].focus();
          break;

        case "Home":
          e.preventDefault();
          tabs[0].focus();
          break;

        case "End":
          e.preventDefault();
          tabs[tabs.length - 1].focus();
          break;
      }
    });
  });
}

/* Inicialização */
document.addEventListener("DOMContentLoaded", () => {
  configurarNavegacaoTeclado();

  /* Define a primeira aba como ativa ao carregar */
  if (tabs.length > 0) {
    tabs[0].setAttribute("tabindex", "0");
    ativarSemestre("1");
  }
});
